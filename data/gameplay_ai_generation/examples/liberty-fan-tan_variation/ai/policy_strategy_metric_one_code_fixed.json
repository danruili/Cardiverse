{
    "game_description": "## Refined Ruleset for Card Game: \"Fusion Rummy\"\n\n### 1. **Game State**\n\n#### **Common Information:**\n- **Communal Pool:** Cards that are laid down and visible to all players, used for fusion.\n- **Pot:** Number of counters in the pot visible to all players.\n- **Current Player:** The active player's turn status, with previous actions taken.\n- **Sequence Information:** Current suit being played and its sequence.\n\n#### **Player-Specific Information:**\n- **Public**:\n  - **Fusion Cards:** Displayed unique fusion cards for each player.\n  - **Chips in Front:** If additional chips are anteed due to unequal cards.\n- **Private**:\n  - **Player Hand:** Cards held by the player, visible only to them.\n  - **Special Abilities:** Any special effects granted by fusion cards.\n\n---\n\n### 2. **Card**\n\n#### **Attributes:**\n- **Rank:** K, Q, J, 10, 9, 8, 7, 6, 5, 4, 3, 2, A (with King being high).\n- **Suit:** Hearts, Diamonds, Clubs, Spades.\n\n#### **Special Values:**\n- **Fusion Cards:** Derived from sequences of three consecutive ranks that offer strategic advantages.\n\n---\n\n### 3. **Deck and Initial Dealing**\n\n#### **Deck Composition:**\n- A standard 52-card deck, comprising 13 ranks across 4 suits.\n\n#### **Initial Dealing:**\n- Cards are dealt one at a time starting from the player to the left of the dealer until all cards are allocated. \n- Some players may have more cards than others. Players with fewer cards must ante an additional chip to the pot.\n\n---\n\n### 4. **Legal Action Space**\n\n#### **On a Turn, a Player May:**\n1. **Play a Card:**\n   - Play the next higher card in the current suit in sequence.\n   - Pre-requisite: Card must follow the current suit and sequence.\n2. **Place a Counter:**\n   - Place one counter into the pot if unable or unwilling to play.\n3. **Create a Fusion Card:**\n   - Form a sequence of three consecutive cards solely from their hand.\n   - Added Clarification: Cards used for fusion are removed from the player's hand and displayed publicly, contributing to the player's fusion count.\n4. **Use Fusion Special Ability:**\n   - Activate special abilities provided by previously formed fusion cards during the player's turn.\n\n---\n\n### 5. **Round**\n\n#### **Sequence of Play:**\n1. The player to the dealer's left starts the play by playing a card of choice.\n2. Each subsequent player must follow the sequence:\n   - Play a higher rank of the same suit, OR\n   - Place a counter in the pot if unable or unwilling to play the required card.\n3. Players may form fusion cards from valid sequences purely in their hands.\n4. Continuation until the suit is exhausted, or a player fulfills the fusion card requirement.\n5. Player completing a sequence can start a new suit sequence.\n6. A player wins the game by creating the designated number of fusion cards.\n7. Rounds end when a player creates the required number of fusion cards or all card sequences are exhausted.\n\n#### **Winning Conditions:**\n- The first player to create three unique fusion cards wins the game, immediately ending the current round and ignoring leftover cards.\n\n---\n\n### 6. **Other Game Mechanics & Rules**\n\n- **Reform Initiative:** Upon exhausting a suit sequence, the player may start a new suit.\n- **Fusion Abilities:** Include actions like skip-turn effects, card protection, or counter retrieval from the pot, used during the player's turn.\n- **Card Exhaustion:** If all sequences are exhausted, the round ends normally.\n\n---\n\n### 7. **Player Observation Information**\n\n#### **Visible Information to Each Player:**\n- Their own hand.\n- Communal pool of cards.\n- Current pot chips.\n- Publicly displayed fusion cards and their effects.\n- Actions taken by every player during their turn.\n\n#### **Hidden Information:**\n- Unrevealed card sequences or strategies of other players.\n\n---\n\n### 8. **Payoffs**\n\n#### **End of Round Scoring:**\n- Scoring for rounds via card remnants is nullified if the game ends via fusion victory.\n- In games without an immediate fusion victory, traditional scoring proceeds; 1 point for each card left.\n\n#### **Fusion Bonuses:**\n- Formation of unique and strategic fusion cards that empower players with special actions and directly influence game outcomes. \n\nThis refined version maintains consistency in the rules and resolves previous ambiguities, enhancing the clarity and strategic depth of \"Fusion Rummy.\"",
    "input_description": "Example: \n{\"common\": {\"num_players\": 4, \"current_player\": 2, \"pot\": 4, \"communal_pool\": [{\"rank\": \"J\", \"suit\": \"spades\"}, {\"rank\": \"Q\", \"suit\": \"spades\"}], \"sequence_info\": {\"current_suit\": \"spades\", \"current_sequence\": [\"J\", \"Q\"]}, \"facedown_cards\": {\"stock_size\": 0}, \"is_over\": false, \"winner\": null}, \"players\": [{\"public\": {\"fusion_cards\": [], \"chips_in_front\": 1}}, {\"public\": {\"fusion_cards\": [], \"chips_in_front\": 2}}, {\"public\": {\"fusion_cards\": [], \"chips_in_front\": 1, \"current_player\": true}, \"private\": {\"player_hand\": [{\"rank\": \"5\", \"suit\": \"hearts\"}, {\"rank\": \"7\", \"suit\": \"hearts\"}, {\"rank\": \"K\", \"suit\": \"hearts\"}, {\"rank\": \"4\", \"suit\": \"hearts\"}, {\"rank\": \"3\", \"suit\": \"spades\"}, {\"rank\": \"3\", \"suit\": \"hearts\"}, {\"rank\": \"K\", \"suit\": \"spades\"}, {\"rank\": \"7\", \"suit\": \"diamonds\"}, {\"rank\": \"10\", \"suit\": \"spades\"}, {\"rank\": \"Q\", \"suit\": \"clubs\"}, {\"rank\": \"A\", \"suit\": \"hearts\"}, {\"rank\": \"5\", \"suit\": \"spades\"}, {\"rank\": \"A\", \"suit\": \"diamonds\"}], \"special_abilities\": []}}, {\"public\": {\"fusion_cards\": [], \"chips_in_front\": 0}}], \"recent_history\": [{\"type\": \"action\", \"player_id\": 2, \"action\": {\"action\": \"place_counter\", \"id\": 0}, \"msg\": \"Player 2 decides to: place_counter\"}, {\"type\": \"info\", \"msg\": \"Player 2's action: place_counter.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Player 2 places a counter into the pot.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 2, \"msg\": \"---------- End of Player 2's turn ----------\"}, {\"type\": \"action\", \"player_id\": 3, \"action\": {\"action\": \"play_card\", \"args\": {\"card\": {\"rank\": \"Q\", \"suit\": \"spades\"}}, \"id\": 0}, \"msg\": \"Player 3 decides to: play_card-(card: Q-spades)\"}, {\"type\": \"info\", \"msg\": \"Player 3's action: play_card.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Player 3 plays Q-spades.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 3, \"msg\": \"---------- End of Player 3's turn ----------\"}, {\"type\": \"action\", \"player_id\": 0, \"action\": {\"action\": \"place_counter\", \"id\": 0}, \"msg\": \"Player 0 decides to: place_counter\"}, {\"type\": \"info\", \"msg\": \"Player 0's action: place_counter.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Player 0 places a counter into the pot.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 0, \"msg\": \"---------- End of Player 0's turn ----------\"}, {\"type\": \"action\", \"player_id\": 1, \"action\": {\"action\": \"place_counter\", \"id\": 0}, \"msg\": \"Player 1 decides to: place_counter\"}, {\"type\": \"info\", \"msg\": \"Player 1's action: place_counter.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Player 1 places a counter into the pot.\", \"role\": null}], \"legal_actions\": [{\"action\": \"play_card\", \"args\": {\"card\": {\"rank\": \"K\", \"suit\": \"spades\"}}, \"id\": 0}, {\"action\": \"create_fusion_card\", \"args\": {\"cards\": [{\"rank\": \"3\", \"suit\": \"hearts\"}, {\"rank\": \"4\", \"suit\": \"hearts\"}, {\"rank\": \"5\", \"suit\": \"hearts\"}]}, \"id\": 1}]}\n\nExplanation: \n{\"common\": \"A dictionary holding common game-related information shared across all players.\", \"common.num_players\": \"An integer representing the total number of players participating in the game.\", \"common.current_player\": \"An integer index of the player whose turn it is currently in the game.\", \"common.pot\": \"An integer representing the total number of chips currently in the pot.\", \"common.communal_pool\": \"A list of card dictionaries representing the cards currently in the communal pool, which are visible to all players.\", \"common.sequence_info\": \"A dictionary containing information about the current card sequence that is being played.\", \"common.sequence_info.current_suit\": \"A string representing the suit of the current card sequence in play.\", \"common.sequence_info.current_sequence\": \"A list of strings representing the ranks of cards in the current sequence played.\", \"common.facedown_cards\": \"A dictionary containing information about the facedown cards remaining in the game.\", \"common.facedown_cards.stock_size\": \"An integer indicating the number of cards remaining in the facedown stock pile.\", \"common.is_over\": \"A boolean indicating whether the game has ended (true) or is still ongoing (false).\", \"common.winner\": \"An integer or null representing the index of the winning player, or null if there is no winner yet.\", \"players\": \"A list containing dictionaries of individual player state information.\", \"players[N].public\": \"A dictionary holding public information about player N that is visible to all players.\", \"players[N].public.fusion_cards\": \"A list of lists representing the fusion cards created by player N. Each sublist is a set of three cards forming a valid fusion.\", \"players[N].public.chips_in_front\": \"An integer representing the number of chips player N currently has in front of them, visible to all players.\", \"players[N].private\": \"A dictionary containing private information about player N that is only visible to this player.\", \"players[N].private.player_hand\": \"A list of card dictionaries representing the player's current hand of cards.\", \"players[N].private.special_abilities\": \"A list of strings representing the special abilities available to the player.\", \"recent_history\": \"A list of dictionaries representing actions and messages from recent turns, including actions taken by players and informational messages.\", \"recent_history[N].type\": \"A string indicating the type of event, such as 'action', 'info', or 'turn_end'.\", \"recent_history[N].player_id\": \"An integer indicating which player performed the action; used in events of type 'action' or 'turn_end'.\", \"recent_history[N].action\": \"A dictionary providing details about the action taken, present when the type of event is 'action'.\", \"recent_history[N].msg\": \"A string containing a descriptive message about the event or action.\", \"legal_actions\": \"A list of dictionaries representing the legal actions available to the current player.\", \"legal_actions[N].action\": \"A string specifying the type of action that the current player can take, such as 'play_card' or 'create_fusion_card'.\", \"legal_actions[N].args\": \"A dictionary containing arguments related to the action, such as card information for 'play_card'.\"}",
    "policy_list": [
        "**Fusion Formation Potential**\nEvaluates the potential to form a fusion card from the player's current hand. High potential encourages prioritizing the creation of a fusion card. The metric considers the number of potential sequences in hand and weighs their formation value.\n**Suit Sequence Advantage**\nMeasures the advantage within the current suit sequence. It takes into account the number of playable cards in the player's hand that can follow the current sequence and the likelihood of opponents not having the required cards to continue.\n**Resource Management**\nConsiders the number of remaining chips and weighs the potential costs/benefits of placing a chip versus playing a card. It reflects the player's ability to manage resources effectively for the overall game strategy.\n**Special Ability Utilization**\nAssesses the strategic value of using a special ability from the player's fusion cards during their turn. It calculates potential game dynamics shifts as a result of the ability, like impacting opponent turns or safeguarding the player's position.\n**Sequence Optimization**\nFocus on aligning and arranging your hand to maximize the potential to form sequences that can be played consecutively using the current suit, thus exhausting your hand efficiently.\n**Fusion Focus**\nPrioritize forming fusion cards by looking for three consecutive ranks in your hand, even if it might mean holding back from playing an immediate card.\n**Aggressive Play**\nExhaust opponent resources by consistently playing cards of the current sequence, forcing other players to contribute counters when they can't play.\n**Resource Management**\nMonitor and manage your chips and fusion cards optimally, ensuring resilience and scalability, ensuring long-term adaptability and power retention."
    ],
    "code": [
        "\ndef score(state: dict, action: dict) -> float:\n    import math  # allowed module\n\n    # Initialize reward components\n    fusion_potential_score = 0.0\n    suit_sequence_score = 0.0\n    resource_management_score = 0.0\n    special_ability_utilization_score = 0.0\n\n    # Extract game state details\n    num_players = state['common']['num_players']\n    current_player = state['common']['current_player']\n    pot = state['common']['pot']\n    communal_pool = state['common']['communal_pool']\n    sequence_info = state['common']['sequence_info']\n    current_suit = sequence_info['current_suit']\n    current_sequence = sequence_info['current_sequence']\n    \n    player_hand = state['players'][current_player]['private']['player_hand']\n    fusion_cards = state['players'][current_player]['public']['fusion_cards']\n    chips_in_front = state['players'][current_player]['public']['chips_in_front']\n    special_abilities = state['players'][current_player]['private']['special_abilities']\n    \n    # Legal actions\n    legal_actions = state['legal_actions']\n\n    # Define ranks in order to easily find sequences\n    rank_order = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K']\n\n    # Fusion Formation Potential: Calculate potential fusion sequences in hand\n    player_hand_ranks = [card['rank'] for card in player_hand]\n    unique_sequences = set()\n    player_hand_ranks.sort(key=lambda x: rank_order.index(x))\n    for i in range(len(player_hand_ranks)):\n        for j in range(i + 1, len(player_hand_ranks)):\n            for k in range(j + 1, len(player_hand_ranks)):\n                triad = (player_hand_ranks[i], player_hand_ranks[j], player_hand_ranks[k])\n                if rank_order.index(triad[2]) - rank_order.index(triad[1]) == 1 and rank_order.index(triad[1]) - rank_order.index(triad[0]) == 1:\n                    unique_sequences.add(triad)\n    \n    fusion_potential_score = len(unique_sequences) / max(1, len(player_hand) // 3)\n\n    # Suit Sequence Advantage: Number of playable cards in the current sequence\n    cards_in_suit = [card for card in player_hand if card['suit'] == current_suit]\n    playable_cards = [card for card in cards_in_suit if rank_order.index(card['rank']) > rank_order.index(current_sequence[-1])]\n    suit_sequence_score = len(playable_cards) / max(1, len(cards_in_suit))\n\n    # Resource Management: Consider number of chips in front of player\n    average_chips = sum(player['public']['chips_in_front'] for player in state['players']) / num_players\n    if chips_in_front > average_chips:\n        resource_management_score = 1.0\n    else:\n        # Linear scaling based on chip count difference\n        resource_management_score = chips_in_front / max(1, average_chips)\n\n    # Special Ability Utilization: Potential shifts from using special abilities\n    special_ability_utilization_score = len(special_abilities) / max(1, len(fusion_cards))\n\n    # Normalize and combine scores\n    result_score = 0.2 * fusion_potential_score + \\\n                   0.3 * suit_sequence_score + \\\n                   0.2 * resource_management_score + \\\n                   0.1 * special_ability_utilization_score + \\\n                   0.2 * len(fusion_cards) / 3  # Additional boost for already formed fusion cards\n\n    # Clamp result_score to [0, 1]\n    result_score = min(1.0, max(0.0, result_score))\n\n    return result_score\n"
    ]
}