{
    "game_description": "# Hearts of Time Game System Ruleset (Refined)\n\n### 1. **Game State**\n\n#### **Common Information:**\n- **Trick History:** Sequence of played cards in each trick, visible to all players.\n- **Current Leader:** Player who won the last trick, visible to all players.\n- **Turn Information:** Current player and actions taken during the turn.\n- **Player Order:** Logical order of play, visible to all players.\n\n#### **Player-Specific Information:**\n- **Public**:\n  - **Scores:** Current interference (disturbance scores) known at all times.\n  - **Trick Wins:** Number of tricks each player has won.\n- **Private**:\n  - **Player Hand:** Cards held by the player.\n  - **Temporal Suit Shift Status:** Whether the player has used their shift ability.\n\n---\n\n### 2. **Card**\n\n#### **Attributes:**\n- **Rank:** From 2 to Ace.\n- **Suit:** One of {Hearts, Diamonds, Clubs, Spades}.\n- **Special Cards:**\n  - **Queen of Spades:** 13 points of disturbance.\n  - **Hearts:** Each incurs 1 point of disturbance.\n\n---\n\n### 3. **Deck and Initial Dealing**\n\n#### **Deck Composition:**\n- A standard 52-card deck divided into four suits.\n\n#### **Initial Dealing:**\n- **4 Players:** Each player receives 13 cards.\n- Other player counts require deck adjustment by removing low-ranking cards, maintaining suit balance.\n\n---\n\n### 4. **Legal Action Space**\n\n#### **On a Turn, a Player May:**\n1. **Lead a Trick:**\n   - Play any card from their hand.\n   - Pre-requisite: Must follow suit, unless void in that suit.\n2. **Follow a Trick:**\n   - Play a card matching the led suit, if possible.\n   - Else, play any card.\n3. **Declare Temporal Suit Shift:**\n   - Announce the shift of rule for a trick to establish a temporary trump suit. This can be declared before playing any card during a player's turn.\n   - Pre-requisite: Can only be used once per game per player.\n\n---\n\n### 5. **Round**\n\n#### **Sequence of Play:**\n1. The player with the 2 of Clubs starts the first trick.\n2. Players take turns in clockwise order, leading with the suit following rules.\n3. Each trick consists of:\n   - Playing cards in the order of player turns.\n   - Using Temporal Suit Shift if strategically advantageous. When declared, the player's chosen suit acts as trump for that entire trick.\n4. The winner of a trick leads the next trick.\n5. Play continues until all cards have been played.\n\n#### **Winning Conditions:**\n- Game ends when a player reaches a preset disturbance threshold (commonly 100 points).\n- Player with the lowest disturbance score wins.\n\n---\n\n### 6. **Other Game Mechanics & Rules**\n\n- **No Hearts or Queen of Spades First Trick:** During the first trick, players must avoid playing hearts or the Queen of Spades unless they have no alternative.\n- **Shooting the Moon:** Capturing all Hearts and Queen of Spades reduces disturbance to zero for that round, increasing opponents' scores by 26 points.\n- **Temporal Strategy:** Deciding when to use Temporal Suit Shift is critical to altering trick outcomes. The temporary trump suit impacts only one trick and reverts after its resolution.\n\n---\n\n### 7. **Player Observation Information**\n\n#### **Visible Information to Each Player:**\n- Cards in their own hand.\n- Cards played in tricks.\n- Scores of each player.\n- Temporal Suit Shift use and declared trump suit.\n\n#### **Hidden Information:**\n- Cards in opponents\u2019 hands.\n\n---\n\n### 8. **Payoffs**\n\n##### **Endgame Scoring:**\n- A point of disturbance equals 1 for each Heart.\n- Queen of Spades is worth 13 disturbance points.\n- Shooting the Moon results in zero points for the round, with opponents' scores increased.\n\n##### **Winning Player\u2019s Reward:**\n- Having the lowest disturbance score leads to victory when the game concludes.\n\nWith these refinements, the \"Hearts of Time\" game provides clarity on the use and impact of Temporal Suit Shift, maintaining the intrigue and strategy native to Hearts, while clearly outlining the new rules. Enjoy your journey through the mystical realm as you guide your temporal path among the \"Hearts of Time.\"",
    "input_description": "Example: \n{\"common\": {\"num_players\": 4, \"current_player\": 1, \"current_leader\": null, \"is_over\": false, \"trick_history\": [], \"current_trick\": [{\"player\": 3, \"card\": {\"rank\": \"4\", \"suit\": \"clubs\"}}, {\"player\": 0, \"card\": {\"rank\": \"6\", \"suit\": \"clubs\"}}], \"temporary_trump\": \"hearts\", \"won_tricks\": {\"0\": 0, \"1\": 0, \"2\": 0, \"3\": 0}, \"disturbance_scores\": {\"0\": 0, \"1\": 0, \"2\": 0, \"3\": 0}, \"temporal_shift_status\": {\"0\": true, \"1\": true, \"2\": true, \"3\": true}, \"facedown_cards\": {\"deck_size\": 0}}, \"players\": [{\"public\": {\"scores\": 0, \"trick_wins\": 0}}, {\"public\": {\"scores\": 0, \"trick_wins\": 0, \"current_player\": true}, \"private\": {\"hand\": [{\"rank\": \"5\", \"suit\": \"diamonds\"}, {\"rank\": \"3\", \"suit\": \"clubs\"}, {\"rank\": \"10\", \"suit\": \"spades\"}, {\"rank\": \"9\", \"suit\": \"clubs\"}, {\"rank\": \"2\", \"suit\": \"spades\"}, {\"rank\": \"4\", \"suit\": \"hearts\"}, {\"rank\": \"3\", \"suit\": \"diamonds\"}, {\"rank\": \"5\", \"suit\": \"clubs\"}, {\"rank\": \"2\", \"suit\": \"diamonds\"}, {\"rank\": \"2\", \"suit\": \"hearts\"}, {\"rank\": \"6\", \"suit\": \"spades\"}, {\"rank\": \"5\", \"suit\": \"hearts\"}, {\"rank\": \"3\", \"suit\": \"spades\"}], \"temporal_shift_used\": true}}, {\"public\": {\"scores\": 0, \"trick_wins\": 0}}, {\"public\": {\"scores\": 0, \"trick_wins\": 0}}], \"recent_history\": [{\"type\": \"action\", \"player_id\": 1, \"action\": {\"action\": \"declare_shift\", \"args\": {\"suit\": \"hearts\"}, \"id\": 0}, \"msg\": \"Player 1 decides to: declare_shift-(suit: hearts)\"}, {\"type\": \"info\", \"msg\": \"Player 1 declared a temporal suit shift to hearts.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Next player is Player 2.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 1, \"msg\": \"---------- End of Player 1's turn ----------\"}, {\"type\": \"action\", \"player_id\": 2, \"action\": {\"action\": \"declare_shift\", \"args\": {\"suit\": \"clubs\"}, \"id\": 2}, \"msg\": \"Player 2 decides to: declare_shift-(suit: clubs)\"}, {\"type\": \"info\", \"msg\": \"Player 2 declared a temporal suit shift to clubs.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Next player is Player 3.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 2, \"msg\": \"---------- End of Player 2's turn ----------\"}, {\"type\": \"action\", \"player_id\": 3, \"action\": {\"action\": \"declare_shift\", \"args\": {\"suit\": \"hearts\"}, \"id\": 0}, \"msg\": \"Player 3 decides to: declare_shift-(suit: hearts)\"}, {\"type\": \"info\", \"msg\": \"Player 3 declared a temporal suit shift to hearts.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Next player is Player 0.\", \"role\": null}, {\"type\": \"turn_end\", \"player_id\": 3, \"msg\": \"---------- End of Player 3's turn ----------\"}, {\"type\": \"action\", \"player_id\": 0, \"action\": {\"action\": \"play_card\", \"args\": {\"suit\": \"clubs\", \"rank\": \"6\"}, \"id\": 4}, \"msg\": \"Player 0 decides to: play_card-(suit: clubs, rank: 6)\"}, {\"type\": \"info\", \"msg\": \"Player 0 played 6-clubs.\", \"role\": null}, {\"type\": \"info\", \"msg\": \"Next player is Player 1.\", \"role\": null}], \"legal_actions\": [{\"action\": \"play_card\", \"args\": {\"suit\": \"clubs\", \"rank\": \"3\"}, \"id\": 0}, {\"action\": \"play_card\", \"args\": {\"suit\": \"clubs\", \"rank\": \"9\"}, \"id\": 1}, {\"action\": \"play_card\", \"args\": {\"suit\": \"clubs\", \"rank\": \"5\"}, \"id\": 2}]}\n\nExplanation: \n{\"common\": \"A dictionary containing shared information about the game, accessible to all players.\", \"common.num_players\": \"The total number of players participating in the game, which is 4 in this case.\", \"common.current_player\": \"The ID of the player who is currently taking their turn, set to Player 1.\", \"common.current_leader\": \"The ID of the player who led the current trick or will lead the next trick, initially null.\", \"common.is_over\": \"A boolean indicating whether the game has ended, currently set to false.\", \"common.trick_history\": \"A list tracking the history of completed tricks, initially empty in this state.\", \"common.current_trick\": \"A list representing the cards currently played in this trick with player IDs and their corresponding cards.\", \"common.temporary_trump\": \"The suit declared as the temporary trump for the current trick, set to 'hearts'.\", \"common.won_tricks\": \"A dictionary counting the number of tricks won by each player, all set to 0 initially.\", \"common.disturbance_scores\": \"A dictionary tracking the disturbance scores for each player, all starting at 0.\", \"common.temporal_shift_status\": \"A dictionary indicating whether each player has used their ability to declare a temporary trump, all marked as true.\", \"common.facedown_cards\": \"A dictionary containing the remaining cards in the deck, currently showing a deck size of 0.\", \"players\": \"A list of dictionaries where each entry contains information specific to an individual player, including both public and private fields.\", \"players[].public\": \"Publicly visible information for a player, including scores and trick wins.\", \"players[].private\": \"Information only visible to the individual player, including their hand and the temporal shift usage status.\", \"recent_history\": \"A list recording recent actions taken during the game, each entry indicates who performed an action, what action it was, and any remarks.\", \"legal_actions\": \"A list of dictionaries representing the actions the current player can legally perform, each with an 'action' type and potential 'args'.\"}",
    "policy_list": [
        "**Hand Disturbance Potential**\nThe total potential disturbance points in the AI player's hand, calculated by counting hearts as 1 point each and the Queen of Spades as 13 points. This metric evaluates the immediate risk associated with the cards currently held by the player.",
        "**Suit Control Factor**\nA measure of how many cards of each suit the AI player holds, indicating the player's ability to control the flow of play within a suit. This helps in deciding when to safely play or lead a particular suit without risking high disturbance points.",
        "**Temporal Suit Shift Opportunity**\nAn assessment based on the current game state to determine the strategic benefit of declaring a Temporal Suit Shift. This includes considering the player's hand strength in various suits, opponents' potential cards, and the timing within the game.",
        "**Trick Winning Probability**\nThe likelihood of winning the current trick based on the player's cards, the cards already played, and the dynamics of the current trick (e.g., current lead card and suit). This probability helps the AI player decide on aggressive versus defensive play styles."
    ],
    "code": [
        "\ndef score(state: dict, action: dict) -> float:\n    # Initialize variables\n    current_player_id = state[\"common\"][\"current_player\"]\n    current_hand = state[\"players\"][current_player_id][\"private\"][\"hand\"]\n    disturbance_scores = state[\"common\"][\"disturbance_scores\"]\n\n    # Calculate disturbance potential of the player's hand\n    hand_disturbance = sum(1 for card in current_hand if card['suit'] == 'hearts') + \\\n                       sum(13 for card in current_hand if card['suit'] == 'spades' and card['rank'] == 'queen')\n\n    # Calculate the current game's disturbance total including all players\n    total_disturbance = sum(disturbance_scores.values())\n\n    # Calculate baseline for the player's potential to shoot the moon\n    opponent_max_disturbance = max(disturbance_scores[pid] for pid in range(len(state[\"players\"])) if pid != current_player_id)\n\n    # Assess action impact\n    if action[\"action\"] == \"play_card\":\n        card_to_play = action[\"args\"]\n        if card_to_play[\"suit\"] == \"hearts\":\n            hand_disturbance -= 1\n        elif card_to_play[\"suit\"] == \"spades\" and card_to_play[\"rank\"] == \"queen\":\n            hand_disturbance -= 13\n\n    # Factor in disturbance of the hand and current scores\n    score_reduction_factor = (total_disturbance - disturbance_scores[current_player_id]) / max(1, opponent_max_disturbance)\n\n    # Calculate reward\n    if total_disturbance >= 100:\n        result_score = 1 if disturbance_scores[current_player_id] < opponent_max_disturbance else 0\n    else:\n        result_score = max(0, 1 - (hand_disturbance / 26)) * score_reduction_factor\n\n    # Return continuous reward between 0 and 1\n    return result_score\n",
        "\ndef score(state: dict, action: dict) -> float:\n    # Extracting necessary game state information\n    current_player = state[\"common\"][\"current_player\"]\n    player_hand = state[\"players\"][current_player][\"private\"][\"hand\"]\n    disturbance_scores = state[\"common\"][\"disturbance_scores\"]\n    current_trick = state[\"common\"][\"current_trick\"]\n    legal_actions = state[\"legal_actions\"]\n    \n    # Initialize reward estimate variables\n    total_suit_counts = {\"hearts\": 0, \"diamonds\": 0, \"clubs\": 0, \"spades\": 0}\n    \n    # Calculate the control a player has for each suit in their hand\n    for card in player_hand:\n        total_suit_counts[card[\"suit\"]] += 1\n\n    # Determine how many legal actions the player has for the current trick\n    num_legal_actions = len(legal_actions)\n\n    # Calculate Suit Control Factor (the more cards a player has in one suit, the higher the control)\n    control_factor = 0\n    for suit, count in total_suit_counts.items():\n        control_factor += (count / len(player_hand)) ** 2\n\n    # Assume an initial neutral winning probability\n    base_score = 0.5\n\n    # Factor in disturbance scores\n    max_disturbance = max(disturbance_scores.values())\n    if max_disturbance > 0:\n        disturbance_impact = (max_disturbance - disturbance_scores[current_player]) / max_disturbance\n    else:\n        disturbance_impact = 1.0\n\n    # Calculate possible impact of chosen action\n    action_score = 0\n\n    if action[\"action\"] == \"play_card\":\n        play_card_suit = action[\"args\"][\"suit\"]\n        \n        # Encourage playing higher control cards when leading\n        if len(current_trick) == 0 and control_factor > 0.5:\n            action_score += 0.1 * control_factor\n        \n        # Discount score for playing disturbing cards (hearts or queen of spades)\n        if play_card_suit == \"hearts\" or (action[\"args\"][\"suit\"] == \"spades\" and action[\"args\"][\"rank\"] == \"Q\"):\n            action_score -= 0.2\n    \n    result_score = base_score + (0.25 * control_factor) + (0.25 * disturbance_impact) + action_score\n    \n    # Ensure score is within bounds [0, 1]\n    result_score = max(0, min(1, result_score))\n    \n    return result_score\n",
        "\ndef score(state: dict, action: dict) -> float:\n    import numpy as np\n\n    num_players = state[\"common\"][\"num_players\"]\n    current_player = state[\"common\"][\"current_player\"]\n    disturbance_scores = state[\"common\"][\"disturbance_scores\"]\n    player_hand = state[\"players\"][current_player][\"private\"][\"hand\"]\n    temporal_shift_used = state[\"players\"][current_player][\"private\"][\"temporal_shift_used\"]\n    current_trick = state[\"common\"][\"current_trick\"]\n    temporary_trump = state[\"common\"][\"temporary_trump\"]\n\n    def evaluate_hand_strength(hand, trump_suit=None):\n        suited_strength = {\"hearts\": 0, \"diamonds\": 0, \"clubs\": 0, \"spades\": 0}\n        for card in hand:\n            increment = 1 if card[\"rank\"] == \"queen\" and card[\"suit\"] == \"spades\" else (1 if card[\"suit\"] == \"hearts\" else 0)\n            suited_strength[card[\"suit\"]] += increment\n        if trump_suit:\n            suited_strength[trump_suit] += np.sum([8 if card[\"suit\"] == trump_suit else 0 for card in hand])\n        return suited_strength\n\n    hand_strength = evaluate_hand_strength(player_hand, temporary_trump)\n\n    if action[\"action\"] == \"declare_shift\":\n        if not temporal_shift_used:\n            suit_shift_score = hand_strength.get(action[\"args\"][\"suit\"], 0) / max(1, len(player_hand))\n            temporal_shift_factor = np.clip(suit_shift_score, 0.2, 0.8)\n        else:\n            temporal_shift_factor = 0.0\n    else:\n        temporal_shift_factor = 0.0\n\n    def calculate_trick_potential(trick, action_card, trump_suit=None):\n        lead_suit = trick[0][\"card\"][\"suit\"] if trick else None\n        if lead_suit == action_card[\"suit\"]:\n            lead_strength = 1\n        elif trump_suit == action_card[\"suit\"]:\n            lead_strength = 0.3\n        else:\n            lead_strength = 0.1\n        return lead_strength\n\n    trick_potential = calculate_trick_potential(current_trick, action[\"args\"], temporary_trump)\n\n    score_player_disturbance = 1.0 - (disturbance_scores.get(str(current_player), 0) / 100)\n\n    continuous_score = 0.5 * score_player_disturbance + 0.3 * trick_potential + 0.2 * temporal_shift_factor\n\n    result_score = np.clip(continuous_score, 0.0, 1.0)\n    return result_score\n",
        "\ndef score(state: dict, action: dict) -> float:\n    # Extract information from the state\n    common = state['common']\n    players = state['players']\n    current_player = common['current_player']\n\n    # Extract the current player's hand and scores\n    player_hand = players[current_player]['private']['hand']\n    disturbance_scores = common['disturbance_scores']\n\n    # Extract current trick information\n    current_trick = common['current_trick']\n    temporary_trump = common['temporary_trump']\n\n    # Count current player's tricks won\n    player_trick_wins = players[current_player]['public']['trick_wins']\n\n    # Calculate baseline probability based on current disturbance\n    max_disturbance = 100\n    player_disturbance = disturbance_scores[current_player]  # Corrected key access\n    base_prob = 1 - (player_disturbance / max_disturbance)\n\n    # Determine action type\n    action_type = action['action']\n    action_card = action['args']\n\n    # Initialize score\n    result_score = base_prob\n    \n    if action_type == \"play_card\":\n        action_suit = action_card['suit']\n        action_rank = action_card['rank']\n\n        # Find led suit in current trick\n        if current_trick:\n            current_lead_suit = current_trick[0]['card']['suit']\n        else:\n            current_lead_suit = None\n\n        # Define rank values for comparison (Ace is high)\n        rank_values = {'2': 1, '3': 2, '4': 3, '5': 4, '6': 5, '7': 6, '8': 7,\n                       '9': 8, '10': 9, 'J': 10, 'Q': 11, 'K': 12, 'A': 13}\n        \n        # Score increment variables\n        rank_increment = 0.0\n        suit_increment = 0.0\n\n        # If the action card follows the lead suit, base increment on rank\n        if action_suit == current_lead_suit:\n            rank_increment = rank_values[action_rank] / 13.0\n        \n        # If action card is in temporary trump suit, weight it more heavily\n        if action_suit == temporary_trump:\n            suit_increment = 0.5  # arbitrary weight for trump suit preference\n        \n        # Combine base probability with calculated increments\n        result_score += rank_increment + suit_increment\n\n    elif action_type == \"declare_shift\":\n        # Assuming some logic for declare_shift\n        # For simplicity, we can return the base probability as the score\n        # This should be updated with suitable logic for your game\n        pass\n\n    # Clamp the result_score to be within 0 to 1\n    result_score = max(0.0, min(1.0, result_score))\n\n    return result_score\n"
    ]
}